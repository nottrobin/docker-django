#! /usr/bin/env bash

set -euo pipefail

# If no default port is set for this project, set it to 8000
if [ -z "${PORT:-}" ]; then
  PORT=8000
fi

run_command=${@:-bash}

# Update any python requirements
if [ -f $REQUIREMENTS_PATH ]; then
    if [ ! -f "${REQUIREMENTS_HASH}" ] || [ "$(cat ${REQUIREMENTS_HASH})" != "$(md5sum $REQUIREMENTS_PATH)" ]; then
        echo "Updating dependencies from $REQUIREMENTS_PATH:" >> /dev/stderr
        pip3 install --requirement $REQUIREMENTS_PATH  # Install new dependencies
        md5sum $REQUIREMENTS_PATH > $REQUIREMENTS_HASH
    fi
else
    echo "$REQUIREMENTS_PATH not found - not installing requirements" >> /dev/stderr
fi

# Run the provided command
$run_command
